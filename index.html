<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PC5 Consumer Master</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            padding: 20px;
            background-color: #f0f2f5;
            color: #333;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px 20px;
            background-color: #2c3e50;
            color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 24px;
            font-weight: 600;
        }
        
        .controls {
            display: flex;
            gap: 10px;
        }
        
        button {
            padding: 10px 16px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        button:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        #column-toggle {
            background-color: #9b59b6;
        }
        
        #column-toggle:hover {
            background-color: #8e44ad;
        }
        
        .data-container {
            overflow-x: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            border: 1px solid #e1e1e1;
            padding: 10px 12px;
            text-align: left;
            white-space: nowrap;
        }
        
        th {
            background-color: #34495e;
            color: white;
            position: sticky;
            top: 0;
            z-index: 10;
            font-weight: 500;
        }
        
        .month-cell {
            background-color: #ecf0f1;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .input-row td {
            background-color: #2c3e50;
            color: white;
            padding: 8px 12px;
        }
        
        .input-row input {
            width: 100%;
            padding: 6px 8px;
            background-color: #34495e;
            color: white;
            border: 1px solid #4a6278;
            border-radius: 4px;
        }
        
        .input-row input:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 100;
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 25px;
            width: 85%;
            max-width: 900px;
            border-radius: 8px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e1e1e1;
        }
        
        .modal-header h2 {
            color: #2c3e50;
            font-weight: 600;
        }
        
        .close {
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #7f8c8d;
            transition: color 0.2s;
        }
        
        .close:hover {
            color: #e74c3c;
        }
        
        .column-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .column-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .column-item:hover {
            background-color: #f8f9fa;
        }
        
        .column-item input {
            margin: 0;
            transform: scale(1.2);
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #e1e1e1;
        }
        
        .modal-actions button {
            padding: 10px 20px;
        }
        
        #select-all {
            background-color: #2ecc71;
        }
        
        #select-all:hover {
            background-color: #27ae60;
        }
        
        #deselect-all {
            background-color: #e74c3c;
        }
        
        #deselect-all:hover {
            background-color: #c0392b;
        }
        
        #apply-columns {
            background-color: #3498db;
        }
        
        #apply-columns:hover {
            background-color: #2980b9;
        }
        
        .hidden {
            display: none;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 10px 15px;
            background-color: #ecf0f1;
            border-radius: 4px;
            font-size: 14px;
            color: #7f8c8d;
        }
        
        tbody tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tbody tr:hover {
            background-color: #e8f4fd;
        }
        
        .month-row {
            font-weight: 500;
        }
        
        .import-export-container {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .import-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .import-controls label {
            font-weight: 500;
            color: #2c3e50;
        }
        
        .import-controls input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
        }
        
        #import-data {
            background-color: #2ecc71;
        }
        
        #import-data:hover {
            background-color: #27ae60;
        }
        
        #export-data {
            background-color: #e74c3c;
        }
        
        #export-data:hover {
            background-color: #c0392b;
        }
        
        .file-input-container {
            position: relative;
            display: inline-block;
        }
        
        .file-input-container input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: #2ecc71;
            color: white;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
        }
        
        .notification.error {
            background-color: #e74c3c;
        }
        
        .highlighted {
            background-color: #fff3cd !important;
            transition: background-color 0.5s;
        }
        
        .progress-container {
            width: 100%;
            background-color: #ecf0f1;
            border-radius: 4px;
            margin: 10px 0;
            display: none;
        }
        
        .progress-bar {
            width: 0%;
            height: 20px;
            background-color: #3498db;
            border-radius: 4px;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: 500;
        }
        
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>PC5 Consumer Master</h1>
            <div class="controls">
                <button id="column-toggle">Toggle Columns</button>
            </div>
        </header>
        
        <div class="status-bar">
            <span id="visible-columns-count">12 columns visible</span>
            <span id="total-rows-count">12 rows</span>
            <span id="import-status">Ready to import</span>
        </div>
        
        <div class="progress-container" id="progress-container">
            <div class="progress-bar" id="progress-bar">0%</div>
        </div>
        
        <div class="data-container">
            <table id="data-table">
                <thead>
                    <tr id="table-header">
                        <!-- Header will be populated by JavaScript -->
                    </tr>
                </thead>
                <tbody id="table-body">
                    <!-- Monthly rows will be populated by JavaScript -->
                </tbody>
                <tfoot>
                    <tr id="input-row" class="input-row">
                        <!-- Input row will be populated by JavaScript -->
                    </tr>
                </tfoot>
            </table>
        </div>
        
        <div class="import-export-container">
            <div class="import-controls">
                <label for="import-value">Consumer Number:</label>
                <input type="text" id="import-value" placeholder="Enter consumer number">
                
                <button id="import-data">Import All Months Data</button>
            </div>
            
            <button id="export-data">Export to Excel</button>
        </div>
    </div>
    
    <!-- Column Toggle Modal -->
    <div id="column-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Select Columns to Display</h2>
                <span class="close">&times;</span>
            </div>
            <div class="column-list" id="column-list">
                <!-- Column list will be populated by JavaScript -->
            </div>
            <div class="modal-actions">
                <button id="select-all">Select All</button>
                <button id="deselect-all">Deselect All</button>
                <button id="apply-columns">Apply Changes</button>
            </div>
        </div>
    </div>
    
    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <script>
        // Define all columns
        const allColumns = [
            "CIRCLE",
            "DIVISION",
            "SUBDIVISION",
            "SUBDIV CODE",
            "BU",
            "SUB STATION CODE",
            "SUB STATION NAME",
            "FEEDER CODE",
            "FEEDER NAME",
            "FEEDER TYPE",
            "FEEDER TYPE DESCRIPTION",
            "MERC FEEDER",
            "SECTION CODE",
            "SECTION NAME",
            "PC",
            "BILLING CYCLE",
            "DTC CODE",
            "DTC NAME",
            "POLE NUMBER",
            "VILLAGE CODE",
            "MRCY",
            "ROUTE",
            "SEQUENCE",
            "CONSUMER NUMBER",
            "CONSUMER_NAME",
            "ADDRESS",
            "MOBILE NUMBER",
            "EMAIL ADDRESS",
            "TAN / PAN",
            "CONS. TYPE",
            "TARIFF CODE",
            "TARIFF DESCRIPTION",
            "TARIFF CAT",
            "ABOVE 20KW",
            "SANC. LOAD",
            "CONN. LOAD",
            "KVA DEMAND",
            "INDUSTRY CODE",
            "AUTHORITY TYPE",
            "AUTHORITY DESCRIPTION",
            "ACTIVITY CODE",
            "ACTIVITY DESCRIPTION",
            "DUTY CODE",
            "DUTY DESCRIPTION",
            "SOLAR ROOF TOP",
            "LIS INDICATOR",
            "URBAN RURAL FLAG",
            "LT TOD OPTION FLAG",
            "DATE OF CONNECTION",
            "DATE OF ASSIGNMENT",
            "MAKE CODE",
            "SERIAL NUMBER",
            "PD / TD DATE",
            "BILL YEAR",
            "BILL MONTH",
            "MS TYPE",
            "MS",
            "METER STATUS",
            "LOCK FAULTY SINCE",
            "METER1 RNA SINCE",
            "METER1 RNA",
            "MF",
            "METER PHASE",
            "METER TYPE CODE",
            "METER SUBTYPE",
            "FIRST BILL INDICATOR",
            "READING DATE",
            "PREVIOUS READING DATE",
            "CURRENT READING",
            "PREVIOUS READING",
            "BILL PERIOD",
            "METER AVERAGE",
            "UNITS KWH",
            "READER NAME",
            "BILL DATE",
            "BILL DUE DATE",
            "PROMPT PAY DATE",
            "PROMPT PAY DISCOUNT",
            "BILL AMOUNT",
            "ARREARS AMOUNT",
            "INTEREST AMOUNT",
            "CURRENT INTEREST",
            "NET BILL AMOUNT",
            "SECURITY DEPOSIT HELD",
            "SD ARREARS",
            "CHEQUE BOUNCE",
            "CONTRACT DEMAND KVA",
            "BILLING DEMAND",
            "LAST RECEIPT DATE",
            "LAST RECEIPT NUMBER",
            "LAST MONTH PAYMENT",
            "CUT OFF DATE",
            "LCR UNITS",
            "LCR AMOUNT",
            "KVAH READING",
            "RKVAH READING LAG",
            "RKVAH READING LEAD",
            "ADJUSTMENT KWH",
            "ADJUSTMENT KVAH",
            "ADJUSTMENT RKVAH LAG",
            "ADJUSTMENT RKVAH LEAD",
            "ASSESSED KVA",
            "MAX DEMAND KVA",
            "AADHAR NUMBER",
            "GO GREEN FLAG",
            "E-BILL DISCOUNT",
            "CAPACITY SOLAR ROOFTOP",
            "SMART METER FLAG",
            "REBATE OFFERED",
            "SLOT3 UNITS"
        ];

        // Initialize visible columns (first 12 columns visible by default)
        let visibleColumns = allColumns.slice(0, 12);

        // GitHub Repository URL - तुमचा URL येथे सेट करा
        const GITHUB_REPO_URL = "https://bu0965.github.io/PC5_CON_MASTER/";

        // Generate months in format 202501, 202502, etc.
        function generateMonths() {
            const months = [];
            const currentYear = new Date().getFullYear();
            for (let i = 1; i <= 12; i++) {
                const month = i < 10 ? `0${i}` : `${i}`;
                months.push(`${currentYear}${month}`);
            }
            return months;
        }

        // Update status bar
        function updateStatusBar() {
            document.getElementById('visible-columns-count').textContent = 
                `${visibleColumns.length} columns visible`;
            document.getElementById('total-rows-count').textContent = '12 rows';
        }

        // Show notification
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = isError ? 'notification error' : 'notification';
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 4000);
        }

        // Update import status
        function updateImportStatus(message) {
            document.getElementById('import-status').textContent = message;
        }

        // Highlight a row temporarily
        function highlightRow(row) {
            row.classList.add('highlighted');
            setTimeout(() => {
                row.classList.remove('highlighted');
            }, 2000);
        }

        // Update progress bar
        function updateProgress(percentage, message = '') {
            const progressBar = document.getElementById('progress-bar');
            const progressContainer = document.getElementById('progress-container');
            
            progressBar.style.width = `${percentage}%`;
            progressBar.textContent = `${percentage}%${message ? ' - ' + message : ''}`;
            
            if (percentage > 0 && percentage < 100) {
                progressContainer.style.display = 'block';
            } else if (percentage === 100) {
                setTimeout(() => {
                    progressContainer.style.display = 'none';
                }, 1000);
            }
        }

        // Show loading state
        function setLoadingState(loading) {
            const importButton = document.getElementById('import-data');
            const container = document.querySelector('.container');
            
            if (loading) {
                container.classList.add('loading');
                importButton.disabled = true;
                importButton.textContent = 'Importing...';
            } else {
                container.classList.remove('loading');
                importButton.disabled = false;
                importButton.textContent = 'Import All Months Data';
            }
        }

        // Initialize the table
        function initializeTable() {
            const tableHeader = document.getElementById('table-header');
            const tableBody = document.getElementById('table-body');
            const inputRow = document.getElementById('input-row');
            
            // Clear existing content
            tableHeader.innerHTML = '';
            tableBody.innerHTML = '';
            inputRow.innerHTML = '';
            
            // Add month header
            const monthHeader = document.createElement('th');
            monthHeader.textContent = 'Month';
            monthHeader.className = 'month-cell';
            tableHeader.appendChild(monthHeader);
            
            // Add columns based on visibility settings
            visibleColumns.forEach(column => {
                // Add header
                const th = document.createElement('th');
                th.textContent = column;
                th.dataset.column = column;
                tableHeader.appendChild(th);
            });
            
            // Generate 12 monthly rows
            const months = generateMonths();
            months.forEach(month => {
                const row = document.createElement('tr');
                row.className = 'month-row';
                row.dataset.month = month;
                
                // Add month cell
                const monthCell = document.createElement('td');
                monthCell.textContent = month;
                monthCell.className = 'month-cell';
                row.appendChild(monthCell);
                
                // Add empty cells for each column
                visibleColumns.forEach(() => {
                    const cell = document.createElement('td');
                    row.appendChild(cell);
                });
                
                tableBody.appendChild(row);
            });
            
            // Add input row at the bottom
            // Month input cell
            const monthInputCell = document.createElement('td');
            monthInputCell.className = 'month-cell';
            const monthSelect = document.createElement('select');
            months.forEach(month => {
                const option = document.createElement('option');
                option.value = month;
                option.textContent = month;
                monthSelect.appendChild(option);
            });
            monthInputCell.appendChild(monthSelect);
            inputRow.appendChild(monthInputCell);
            
            // Add input cells for each column
            visibleColumns.forEach(column => {
                const inputCell = document.createElement('td');
                const input = document.createElement('input');
                input.type = 'text';
                input.placeholder = '';
                inputCell.appendChild(input);
                inputRow.appendChild(inputCell);
            });
            
            updateStatusBar();
            updateImportStatus('Ready to import');
        }

        // Initialize column modal
        function initializeColumnModal() {
            const columnList = document.getElementById('column-list');
            columnList.innerHTML = '';
            
            allColumns.forEach(column => {
                const columnItem = document.createElement('div');
                columnItem.className = 'column-item';
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = `col-${column.replace(/\s+/g, '-')}`;
                checkbox.checked = visibleColumns.includes(column);
                checkbox.dataset.column = column;
                
                const label = document.createElement('label');
                label.htmlFor = checkbox.id;
                label.textContent = column;
                
                columnItem.appendChild(checkbox);
                columnItem.appendChild(label);
                columnList.appendChild(columnItem);
            });
        }

        // Apply column visibility changes
        function applyColumnVisibility() {
            const checkboxes = document.querySelectorAll('#column-list input[type="checkbox"]');
            visibleColumns = [];
            
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    visibleColumns.push(checkbox.dataset.column);
                }
            });
            
            // Ensure at least one column is visible
            if (visibleColumns.length === 0) {
                visibleColumns = [allColumns[0]];
            }
            
            initializeTable();
            closeModal();
        }

        // Export data to Excel
        function exportToExcel() {
            try {
                // Create workbook
                const wb = XLSX.utils.book_new();
                
                // Prepare data for export
                const exportData = [];
                
                // Add headers
                const headers = ['Month', ...visibleColumns];
                exportData.push(headers);
                
                // Add data rows
                const tableBody = document.getElementById('table-body');
                const rows = tableBody.querySelectorAll('tr');
                
                rows.forEach(row => {
                    const rowData = [];
                    const cells = row.querySelectorAll('td');
                    
                    cells.forEach(cell => {
                        rowData.push(cell.textContent || '');
                    });
                    
                    exportData.push(rowData);
                });
                
                // Create worksheet
                const ws = XLSX.utils.aoa_to_sheet(exportData);
                
                // Add worksheet to workbook
                XLSX.utils.book_append_sheet(wb, ws, 'Data');
                
                // Generate Excel file and trigger download
                XLSX.writeFile(wb, `customer_data_${document.getElementById('import-value').value || 'export'}.xlsx`);
                
                showNotification('Data exported successfully!');
            } catch (error) {
                console.error('Export error:', error);
                showNotification('Error exporting data: ' + error.message, true);
            }
        }

        // Extract month from filename
        function extractMonthFromFilename(filename) {
            const match = filename.match(/_(\d{6})\./);
            return match ? match[1] : null;
        }

        // Fetch file from GitHub repository
        async function fetchFileFromGitHub(filePath) {
            try {
                // GitHub Pages साठी direct URL वापरा
                const fileUrl = `${GITHUB_REPO_URL}/${filePath}`;
                console.log('Fetching file from:', fileUrl);
                
                const response = await fetch(fileUrl);
                if (!response.ok) {
                    throw new Error(`Failed to fetch file: ${response.status}`);
                }
                
                const arrayBuffer = await response.arrayBuffer();
                return arrayBuffer;
            } catch (error) {
                console.error('Error fetching file from GitHub:', error);
                throw error;
            }
        }

        // Get list of files from GitHub repository
        async function getFilesFromGitHub() {
            try {
                // GitHub Pages साठी files.json वापरा किंवा hardcode file list
                // किंवा तुमच्या repository मध्ये files.json file तयार करा ज्यामध्ये सर्व Excel files ची यादी असेल
                
                // Hardcoded file list - तुमच्या actual file names ने बदला
                const excelFiles = [
                    { name: "PC_CONSUMERS_MASTER_LIST_0965_05_202501.xls", path: "PC_CONSUMERS_MASTER_LIST_0965_05_202501.xls" },
                    { name: "PC_CONSUMERS_MASTER_LIST_0965_05_202502.xls", path: "PC_CONSUMERS_MASTER_LIST_0965_05_202502.xls" },
                    { name: "PC_CONSUMERS_MASTER_LIST_0965_05_202503.xls", path: "PC_CONSUMERS_MASTER_LIST_0965_05_202503.xls" },
                    { name: "PC_CONSUMERS_MASTER_LIST_0965_05_202504.xls", path: "PC_CONSUMERS_MASTER_LIST_0965_05_202504.xls" },
                    { name: "PC_CONSUMERS_MASTER_LIST_0965_05_202505.xls", path: "PC_CONSUMERS_MASTER_LIST_0965_05_202505.xls" },
                    { name: "PC_CONSUMERS_MASTER_LIST_0965_05_202506.xls", path: "PC_CONSUMERS_MASTER_LIST_0965_05_202506.xls" },
                    { name: "PC_CONSUMERS_MASTER_LIST_0965_05_202507.xls", path: "PC_CONSUMERS_MASTER_LIST_0965_05_202507.xls" },
                    { name: "PC_CONSUMERS_MASTER_LIST_0965_05_202508.xls", path: "PC_CONSUMERS_MASTER_LIST_0965_05_202508.xls" },
                    { name: "PC_CONSUMERS_MASTER_LIST_0965_05_202509.xls", path: "PC_CONSUMERS_MASTER_LIST_0965_05_202509.xls" },
                    { name: "PC_CONSUMERS_MASTER_LIST_0965_05_202510.xls", path: "PC_CONSUMERS_MASTER_LIST_0965_05_202510.xls" },
                    { name: "PC_CONSUMERS_MASTER_LIST_0965_05_202511.xls", path: "PC_CONSUMERS_MASTER_LIST_0965_05_202511.xls" },
                    { name: "PC_CONSUMERS_MASTER_LIST_0965_05_202512.xls", path: "PC_CONSUMERS_MASTER_LIST_0965_05_202512.xls" }
                ];
                
                return excelFiles;
            } catch (error) {
                console.error('Error getting files from GitHub:', error);
                throw error;
            }
        }

        // Import data from all Excel files in GitHub repository
        async function importAllMonthsDataFromGitHub(customerNumber) {
            try {
                setLoadingState(true);
                updateProgress(0, 'Fetching file list from GitHub...');
                
                // Get list of files from GitHub
                const files = await getFilesFromGitHub();
                
                if (files.length === 0) {
                    showNotification('No Excel files found in the repository', true);
                    updateImportStatus('No Excel files found');
                    setLoadingState(false);
                    return;
                }
                
                updateProgress(10, `Found ${files.length} Excel files`);
                
                let processedFiles = 0;
                let foundData = false;
                
                for (const file of files) {
                    try {
                        const month = extractMonthFromFilename(file.name);
                        
                        if (!month) {
                            processedFiles++;
                            updateProgress(Math.round((processedFiles / files.length) * 90) + 10, `Skipping ${file.name}`);
                            continue;
                        }
                        
                        updateProgress(Math.round((processedFiles / files.length) * 90) + 10, `Processing ${file.name}`);
                        
                        // Fetch file content
                        const data = await fetchFileFromGitHub(file.path);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                        
                        if (jsonData.length > 0) {
                            const headers = jsonData[0];
                            const consumerNumberIndex = 23; // Column X is index 23 (0-based)
                            
                            // Find the row with matching customer number
                            let customerRow = null;
                            for (let i = 1; i < jsonData.length; i++) {
                                const rowData = jsonData[i];
                                if (rowData && rowData[consumerNumberIndex] == customerNumber) {
                                    customerRow = rowData;
                                    break;
                                }
                            }
                            
                            if (customerRow) {
                                // Find the row for this month in our table
                                const tableBody = document.getElementById('table-body');
                                const targetRow = tableBody.querySelector(`tr[data-month="${month}"]`);
                                
                                if (targetRow) {
                                    const cells = targetRow.querySelectorAll('td');
                                    
                                    // Update data cells
                                    visibleColumns.forEach((column, cellIndex) => {
                                        const columnIndex = headers.indexOf(column);
                                        if (columnIndex !== -1 && customerRow[columnIndex] !== undefined) {
                                            cells[cellIndex + 1].textContent = customerRow[columnIndex];
                                        }
                                    });
                                    
                                    highlightRow(targetRow);
                                    foundData = true;
                                }
                            }
                        }
                    } catch (error) {
                        console.error(`Error processing ${file.name}:`, error);
                    }
                    
                    processedFiles++;
                    updateProgress(Math.round((processedFiles / files.length) * 90) + 10, `Processed ${processedFiles}/${files.length} files`);
                }
                
                setLoadingState(false);
                updateProgress(100, 'Import complete');
                
                if (foundData) {
                    showNotification(`Data imported for customer ${customerNumber} across all months!`);
                    updateImportStatus(`Data imported for ${customerNumber}`);
                } else {
                    showNotification(`No data found for customer ${customerNumber} in any files`, true);
                    updateImportStatus('No data found');
                }
            } catch (error) {
                console.error('Error importing data from GitHub:', error);
                showNotification('Error importing data: ' + error.message, true);
                updateImportStatus('Import failed');
                setLoadingState(false);
            }
        }

        // Modal functions
        function openModal() {
            document.getElementById('column-modal').style.display = 'block';
            initializeColumnModal();
        }

        function closeModal() {
            document.getElementById('column-modal').style.display = 'none';
        }

        // Event listeners
        document.getElementById('column-toggle').addEventListener('click', openModal);
        document.getElementById('apply-columns').addEventListener('click', applyColumnVisibility);
        document.querySelector('.close').addEventListener('click', closeModal);
        
        document.getElementById('select-all').addEventListener('click', () => {
            document.querySelectorAll('#column-list input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = true;
            });
        });
        
        document.getElementById('deselect-all').addEventListener('click', () => {
            document.querySelectorAll('#column-list input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
        });

        document.getElementById('export-data').addEventListener('click', exportToExcel);

        document.getElementById('import-data').addEventListener('click', () => {
            const customerNumber = document.getElementById('import-value').value.trim();
            
            if (!customerNumber) {
                showNotification('Please enter a customer number', true);
                return;
            }
            
            importAllMonthsDataFromGitHub(customerNumber);
        });

        // Close modal when clicking outside
        window.addEventListener('click', (event) => {
            const modal = document.getElementById('column-modal');
            if (event.target === modal) {
                closeModal();
            }
        });

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            initializeTable();
        });
    </script>
</body>
</html>


